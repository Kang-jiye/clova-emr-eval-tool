# constants.py
from typing import List, Tuple, Dict

# 업로드 필수 컬럼
REQUIRED_COLS = ["구분자", "대화 스크립트", "생성결과"]


LIKERT_ITEMS: List[str] = [
    "정확성(Accuracy)",
    "환각여부(Hallucination)",
    "충실성(Throughness)",
    "맥락 통합성(Contextual Coherence)",
    "편향여부(Bias)",
]

# 각 항목의 고정 설명 문구
LIKERT_FIXED_DESC: Dict[int, List[str]] = {
    0: ["생성된 결과가 사실과 일치하며, 잘못된 정보나 수치 오류가 없음", " ", "5점: 모든 정보가 사실과 일치하며, 수치, 이름, 시간, 용어에 오류가 없음", "4점: 사소한 표현 차이는 있으나, 의미 왜곡이나 사실 오류가 없음", "3점: 전반적으로 정확하나, 1-2개의 모호한 표현 혹은 약간의 수치 오류 존재", "2점: 여러 항목에서 사실 또는 용어 오류가 관찰되어 검토가 필요", "1점: 잘못된 정보가 여러 곳에 포함되어 기록을 신뢰하기 어려움"],
    1: ["생성된 EMR이 대화 스크립트로 검증 가능한 내용만을 포함, 근거없는 추정 및 허위 내용 포함하지 않음", " ","5점: 모든 내용이 대화 스크립트에서 직접 확인 가능하며 추가적 창작 없음","4점: 대부분 스크립트 기반으로 경미한 요약 또는 해석 정도 존재하며, 근거가 있음", "3점: 일부 문장은 스크립트 근거가 불분명하나 전체 맥락 이해해 있어서 문제가 없음", "2점: 여러 문장에서 근거 불문명 또는 추정 성격의 문장 존재", "1점: 스크립트와 무관한 정보가 다수 포함되어 허위 생성에 가까움"],
    2: ["기록이 환자의 환자의 주요 정보를 빠짐없이 포함하며, 의미있는 내용의 누락이 없음", " ","5점: 환자 상태 및 주호소, 과거력 등 핵심 내용이 모두 기록되어 누락 없음","4점: 대부분의 핵심 정보가 포함되어 있으나, 부차적 세부 항목 1-2개 누락", "3점: 핵심 정보는 대체로 있지만, 중요 세부(e.g. 기간 또는 증상 강도) 부족", "2점: 여러개의 주요 정보가 누락되어 상황 파악이 어려움", "1점: 환자 문제 또는 주요 사실이 대부분 누락되어있음"],
    3: ["대화 스크립트의 핵심 사실들을 논리적으로 연결되며 일관된 흐릅으로 정리하여 읽는 사람이 환자 상태를 자연스럽게 이해할 수 있음", " ", "5점: 정보가 시간-원인-결과 순서로 자연스럽게 이어지고 중복 및 모순이 없으며, 단락 구성이 명료하여 읽자마자 환자 상태 파악 가능","4점: 전반적으로 잘 통합되어 있으며, 경미한 어색함이나 약한 연결은 있으나 이해헤는 지장 없음", "3점: 핵심 정보는 있으나, 문맥 전환이 부자연스럽고 요점이 분산됨", "2점: 사실만을 나열하여 문맥이 매끄럽지 못하고 이해가 어려우며 재구성이 필요함", "1점: 논리 흐름이 무너져 전체 의미 파악이 불가하며 임상적 맥락 상실"],
    4: ["기록이 환자의 개인적 특성(나이, 성별 등)에 기반한 추정이나 편견을 포함하지 않으며, 대화 스크립트에서 검증 가능한 정보만 포함", " ","5점: 환자의 나이, 성별 등에 대한 해석 및 평가에 대한 언급이 전혀 없으며, 대화에서 언급된 사실만 기술","4점: 전반적으로 객관적이고 중립적이지만, 사실을 해치지 않는 선에서 약간의 암시적 표현 및 경미한 추정이 포함됨", "3점: 대부분 중립적이나 전체 의미에는 큰 왜곡이 없는 선에서 일부 문장에 평가적 어투나 단정적 표현이 존재", "2점: 환자의 나이, 습관 등에 근거하여 원인이나 결과를 추정 및 단정하는 문장이 여러 곳에 존재하며 근거가 불분명함", "1점: 사실에 기반하지 않고, 환자에 대한 주관적 판단 및 평가 표현이 다수 표현되어 있으며 편향이 심함"]
}

PRIMARY_LABELS: List[str] = ["주호소", "현병력", "과거력", "개인력 및 사회력", "계통문진", "신체검진"]
EXCLUDE_LABELS: List[str] = ["진단명", "진단", "진료계획", "진료 계획", "계획"]

# 사용자가 작성하는 EMR 정답 섹션
EMR_SECTIONS: List[Tuple[str, str]] = [
    ("주호소", "chief_complaint"),
    ("현병력", "present_illness"),
    ("과거력", "past_history"),
    ("계통문진", "review_of_systems"),
    ("신체검진", "physical_exam"),
    ("기타", "other"),
]

# 다운로드 엑셀 컬럼 순서
DOWNLOAD_COLUMNS: List[str] = (
    ["새_구분자", "원_구분자"]
    + [f"리커트_{i+1}_점수" for i in range(5)]
    + [label for (label, _) in EMR_SECTIONS]
)

# 라벨 탐지용 정규식 (줄 단위)
LABEL_PATTERN_STR = r"^\s*(주호소|현병력|과거력|개인력\s*및\s*사회력|(?:계통문진|통문진)|신체검진|진단명|진단|진료\s*계획|진료계획|계획)\s*[:：]?\s*$"